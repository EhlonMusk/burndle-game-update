<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BURNdle Admin Dashboard</title>
    <!-- Add Socket.io client library -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f8f9fa;
        color: #333;
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        min-height: 100vh;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        text-align: center;
        position: relative;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        font-weight: 300;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1rem;
      }

      .logout-btn {
        position: absolute;
        top: 2rem;
        right: 2rem;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .stats-section {
        padding: 2rem;
        background: #f8f9fa;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .stat-number {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .stat-label {
        color: #6c757d;
        font-size: 1.1rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .main-content {
        padding: 2rem;
      }

      .section {
        margin-bottom: 3rem;
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #495057;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }


      .config-message.success {
        background: rgba(40, 167, 69, 0.3);
        border: 1px solid rgba(40, 167, 69, 0.5);
      }

      .config-message.error {
        background: rgba(220, 53, 69, 0.3);
        border: 1px solid rgba(220, 53, 69, 0.5);
      }

      .assign-word {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
      }

      .assign-word h3 {
        margin-bottom: 1rem;
        font-size: 1.3rem;
      }

      .assign-word-form {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .assign-word input {
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        min-width: 200px;
      }

      .assign-word input::placeholder {
        color: #6c757d;
      }

      .assign-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .assign-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .assign-btn.danger {
        background: rgba(220, 53, 69, 0.8);
        border-color: rgba(220, 53, 69, 0.9);
      }

      .assign-btn.danger:hover {
        background: rgba(220, 53, 69, 0.9);
      }

      .search-section {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .search-container {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .search-input {
        flex: 1;
        min-width: 300px;
        padding: 0.75rem 1rem;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .search-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .clear-search-btn {
        background: #6c757d;
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .clear-search-btn:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .search-results-info {
        margin-top: 1rem;
        padding: 0.75rem 1rem;
        background: #f8f9fa;
        border-radius: 6px;
        color: #6c757d;
        font-size: 0.9rem;
      }

      .table-container {
        overflow-x: auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
      }

      th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 0.75rem;
        text-align: left;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.8rem;
      }

      td {
        padding: 1rem 0.75rem;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
      }

      tr:hover {
        background: #f8f9fa;
      }

      .wallet-address {
        font-family: "Courier New", monospace;
        font-size: 0.85rem;
        background: #f8f9fa;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        color: #495057;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid transparent;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .wallet-address:hover {
        background: #e9ecef;
        border-color: #667eea;
        transform: translateY(-1px);
      }

      .wallet-address.copied {
        background: #d4edda;
        border-color: #28a745;
        color: #155724;
      }

      .copy-icon {
        font-size: 0.75rem;
        opacity: 0.6;
      }

      .wallet-address:hover .copy-icon {
        opacity: 1;
      }

      .streak {
        font-weight: 700;
        color: #28a745;
        font-size: 1.1rem;
      }

      .win-rate {
        font-weight: 600;
      }

      .next-word {
        font-weight: 600;
        color: #6f42c1;
        text-transform: uppercase;
        font-family: "Courier New", monospace;
        background: #f8f9fa;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        border: 2px solid #e9ecef;
      }

      .login-form {
        max-width: 450px;
        margin: 100px auto;
        padding: 3rem;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .login-form h2 {
        margin-bottom: 2rem;
        color: #495057;
        font-size: 2rem;
        font-weight: 300;
      }

      .form-group {
        margin-bottom: 1.5rem;
        text-align: left;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #495057;
      }

      .form-group input {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .login-btn {
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 2rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .error {
        color: #dc3545;
        margin-top: 1rem;
        font-weight: 500;
      }

      .success {
        color: #28a745;
        margin-top: 1rem;
        font-weight: 500;
      }

      .hidden {
        display: none;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        color: #6c757d;
        padding: 3rem;
        font-size: 1.1rem;
      }

      .refresh-btn {
        background: #17a2b8;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-left: 1rem;
        transition: background 0.3s ease;
      }

      .refresh-btn:hover {
        background: #138496;
      }

      .date {
        color: #6c757d;
        font-size: 0.85rem;
      }

      .websocket-status {
        position: fixed;
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        z-index: 1001;
        transition: all 0.3s ease;
      }

      .websocket-status.connected {
        background: #28a745;
        color: white;
      }

      .websocket-status.disconnected {
        background: #dc3545;
        color: white;
      }

      .websocket-status.connecting {
        background: #ffc107;
        color: black;
      }

      .live-update-notification {
        position: fixed;
        top: 80px;
        right: 20px;
        background: #17a2b8;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        font-weight: 500;
        z-index: 1000;
        animation: slideInRight 0.3s ease-out;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        max-width: 350px;
        word-wrap: break-word;
      }

      .live-update-notification.warning {
        background: #ffc107;
        color: #333;
      }

      .live-update-notification.danger {
        background: #dc3545;
        color: white;
      }

      .live-update-notification.success {
        background: #28a745;
        color: white;
      }

      .admin-controls {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 0;
        margin: 24px 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .admin-controls h3 {
        color: white;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 8px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        text-align: center;
      }

      .control-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        padding: 24px;
      }

      .control-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .control-card.danger-zone {
        background: rgba(220, 53, 69, 0.2);
        border-color: rgba(220, 53, 69, 0.4);
      }

      .control-card h4 {
        margin-bottom: 1rem;
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .control-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .control-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
        text-align: center;
      }

      .control-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .control-btn.refresh {
        background: rgba(23, 162, 184, 0.8);
        border-color: rgba(23, 162, 184, 0.9);
      }

      .control-btn.refresh:hover {
        background: rgba(23, 162, 184, 1);
      }

      .control-btn.warning {
        background: rgba(255, 193, 7, 0.8);
        border-color: rgba(255, 193, 7, 0.9);
        color: #333;
      }

      .control-btn.warning:hover {
        background: rgba(255, 193, 7, 1);
      }

      .control-btn.danger {
        background: rgba(220, 53, 69, 0.8);
        border-color: rgba(220, 53, 69, 0.9);
      }

      .control-btn.danger:hover {
        background: rgba(220, 53, 69, 1);
      }

      .control-btn.info {
        background: rgba(108, 117, 125, 0.8);
        border-color: rgba(108, 117, 125, 0.9);
      }

      .control-btn.info:hover {
        background: rgba(108, 117, 125, 1);
      }

      .control-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
      }

      .pause-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        font-size: 0.9rem;
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        animation: pulse-indicator 2s infinite;
      }

      .status-indicator.active {
        background: #28a745;
      }

      .status-indicator.paused {
        background: #ffc107;
      }

      @keyframes pulse-indicator {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .danger-warning {
        font-size: 0.8rem;
        opacity: 0.8;
        margin-top: 0.5rem;
        text-align: center;
        font-style: italic;
      }

      .control-message {
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem;
        font-weight: 500;
        text-align: center;
        display: none;
      }

      .control-message.success {
        background: rgba(40, 167, 69, 0.2);
        border: 1px solid rgba(40, 167, 69, 0.4);
      }

      .control-message.error {
        background: rgba(220, 53, 69, 0.2);
        border: 1px solid rgba(220, 53, 69, 0.4);
      }

      .control-message.warning {
        background: rgba(255, 193, 7, 0.2);
        border: 1px solid rgba(255, 193, 7, 0.4);
        color: #333;
      }

      .control-message.info {
        background: rgba(23, 162, 184, 0.2);
        border: 1px solid rgba(23, 162, 184, 0.4);
      }

      .table-row-updated {
        background: #d4edda !important;
        transition: background-color 2s ease;
        animation: highlight-row 3s ease-out;
      }

      @keyframes highlight-row {
        0% {
          background: #28a745 !important;
        }
        50% {
          background: #d4edda !important;
        }
        100% {
          background: transparent;
        }
      }

      /* Creator Fees Configuration Styles */
      .creator-fees-config {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 0;
        margin: 24px 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .config-header {
        background: rgba(255, 255, 255, 0.1);
        padding: 24px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      }

      .config-header h3 {
        color: white;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 8px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .config-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        margin: 0;
      }

      .config-content {
        padding: 24px;
      }

      .current-config,
      .update-config {
        margin-bottom: 24px;
      }

      .config-label {
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 12px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .label-icon {
        font-size: 1.1rem;
      }

      .wallet-display-group {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      .wallet-display-input {
        flex: 1;
        min-width: 300px;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        color: #333;
        cursor: text;
      }

      .update-group {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .input-with-validation {
        position: relative;
      }

      .wallet-input {
        width: 100%;
        padding: 14px 16px;
        background: rgba(255, 255, 255, 0.95);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        color: #333;
        transition: all 0.3s ease;
        box-sizing: border-box;
      }

      .wallet-input:focus {
        outline: none;
        border-color: #4caf50;
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
      }

      .wallet-input.valid {
        border-color: #4caf50;
        background: rgba(76, 175, 80, 0.1);
      }

      .wallet-input.invalid {
        border-color: #f44336;
        background: rgba(244, 67, 54, 0.1);
      }

      .input-validation {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        padding: 8px 16px;
        font-size: 12px;
        border-radius: 0 0 8px 8px;
        display: none;
      }

      .input-validation.show {
        display: block;
      }

      .input-validation.valid {
        background: rgba(76, 175, 80, 0.9);
        color: white;
      }

      .input-validation.invalid {
        background: rgba(244, 67, 54, 0.9);
        color: white;
      }

      .action-buttons {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .action-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .copy-btn {
        background: #6c757d;
        color: white;
      }

      .copy-btn:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .view-btn {
        background: #17a2b8;
        color: white;
      }

      .view-btn:hover {
        background: #138496;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .test-btn {
        background: #ffc107;
        color: #333;
      }

      .test-btn:hover:not(:disabled) {
        background: #e0a800;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .update-btn {
        background: #28a745;
        color: white;
      }

      .update-btn:hover:not(:disabled) {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .action-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
      }

      .btn-icon {
        font-size: 14px;
      }

      .test-results {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        margin-top: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .results-header {
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 16px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }

      .result-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 16px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .result-label {
        color: rgba(255, 255, 255, 0.8);
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
      }

      .result-value {
        color: white;
        font-size: 16px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .status-message {
        padding: 16px;
        border-radius: 8px;
        margin-top: 16px;
        font-weight: 500;
        display: none;
        text-align: center;
      }

      .status-message.show {
        display: block;
      }

      .status-success {
        background: rgba(76, 175, 80, 0.9);
        color: white;
        border: 1px solid rgba(76, 175, 80, 0.5);
      }

      .status-error {
        background: rgba(244, 67, 54, 0.9);
        color: white;
        border: 1px solid rgba(244, 67, 54, 0.5);
      }

      .status-info {
        background: rgba(33, 150, 243, 0.9);
        color: white;
        border: 1px solid rgba(33, 150, 243, 0.5);
      }

      .status-loading {
        background: rgba(255, 193, 7, 0.9);
        color: #333;
        border: 1px solid rgba(255, 193, 7, 0.5);
      }

      /* NEW: Current Fees Display Styles */
      .fees-stats-display {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        margin-top: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .fees-sol {
        color: #ffeb3b;
        font-size: 18px;
        text-shadow: 0 0 10px rgba(255, 235, 59, 0.5);
      }

      .fees-usd {
        color: #4caf50;
        font-size: 18px;
        text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
      }

      /* Token Burn Tracker Styles */
      .token-burn-config {
        background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        border-radius: 16px;
        padding: 0;
        margin: 24px 0;
        box-shadow: 0 8px 32px rgba(255, 107, 53, 0.2);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .burn-config-header {
        background: rgba(255, 255, 255, 0.1);
        padding: 24px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      }

      .burn-config-header h3 {
        color: white;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 8px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .burn-config-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        margin: 0;
      }

      .burn-config-content {
        padding: 24px;
      }

      .current-token-section,
      .new-token-section {
        margin-bottom: 24px;
      }

      .token-display-group {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      .token-display-input {
        flex: 1;
        min-width: 300px;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        color: #333;
      }

      .burn-stats-display {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
      }

      .stat-item {
        text-align: center;
        background: rgba(255, 255, 255, 0.1);
        padding: 16px;
        border-radius: 8px;
      }

      .stat-value {
        color: white;
        font-size: 18px;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .burn-percentage {
        color: #ffeb3b;
        font-size: 24px;
        text-shadow: 0 0 10px rgba(255, 235, 59, 0.5);
      }

      .token-config-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .input-label {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
        font-size: 14px;
      }

      .token-input,
      .supply-input {
        width: 100%;
        padding: 14px 16px;
        background: rgba(255, 255, 255, 0.95);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-size: 14px;
        color: #333;
        transition: all 0.3s ease;
        box-sizing: border-box;
      }

      .token-input {
        font-family: "Courier New", monospace;
      }

      .token-input:focus,
      .supply-input:focus {
        outline: none;
        border-color: #4caf50;
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
      }

      .token-input.valid {
        border-color: #4caf50;
        background: rgba(76, 175, 80, 0.1);
      }

      .token-input.invalid {
        border-color: #f44336;
        background: rgba(244, 67, 54, 0.1);
      }

      .input-help {
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
        font-style: italic;
      }

      .burn-analysis {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 24px;
        align-items: center;
      }

      .burn-visualization {
        display: flex;
        justify-content: center;
      }

      .burn-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: conic-gradient(
          #ffeb3b 0deg,
          #ffeb3b var(--burn-angle),
          rgba(255, 255, 255, 0.2) var(--burn-angle),
          rgba(255, 255, 255, 0.2) 360deg
        );
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        --burn-angle: 0deg;
      }

      .burn-circle::before {
        content: "";
        width: 90px;
        height: 90px;
        border-radius: 50%;
        background: rgba(255, 107, 53, 0.9);
        position: absolute;
      }

      .burn-percentage-display {
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 1;
        position: relative;
      }

      .percentage-number {
        font-size: 20px;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }

      .percentage-label {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.8);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .burn-details {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: rgba(255, 255, 255, 0.8);
        font-weight: 500;
      }

      .detail-value {
        color: white;
        font-weight: 600;
        text-align: right;
      }

      .social-links-config {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 0;
        margin: 24px 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .social-links-config .config-header {
        background: rgba(255, 255, 255, 0.1);
        padding: 24px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      }

      .social-links-config .config-header h3 {
        color: white;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 8px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .social-links-config .config-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        margin: 0;
      }

      .social-links-config .config-content {
        padding: 24px;
      }

      .link-config-section {
        margin-bottom: 24px;
      }

      .link-config-section:last-of-type {
        margin-bottom: 0;
      }

      .link-input-group {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }

      .link-input {
        flex: 1;
        min-width: 300px;
        padding: 14px 16px;
        background: #ffffff;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-size: 14px;
        color: #333;
        transition: all 0.3s ease;
        box-sizing: border-box;
      }

      .link-input:focus {
        outline: none;
        border-color: #4caf50;
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
      }

      .link-input:valid {
        border-color: #4caf50;
        background: #ffffff;
      }

      .link-input:invalid:not(:placeholder-shown) {
        border-color: #f44336;
        background: #ffffff;
      }

      #social-links-status {
        margin-top: 16px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .link-input-group {
          flex-direction: column;
          align-items: stretch;
        }

        .link-input {
          min-width: unset;
        }
      }

      /* Status message specific to social links */
      .social-links-config .status-message {
        padding: 16px;
        border-radius: 8px;
        margin-top: 16px;
        font-weight: 500;
        display: none;
        text-align: center;
      }

      .social-links-config .status-message.show {
        display: block;
      }

      .social-links-config .status-success {
        background: rgba(76, 175, 80, 0.9);
        color: white;
        border: 1px solid rgba(76, 175, 80, 0.5);
      }

      .social-links-config .status-error {
        background: rgba(244, 67, 54, 0.9);
        color: white;
        border: 1px solid rgba(244, 67, 54, 0.5);
      }

      .social-links-config .status-loading {
        background: rgba(255, 193, 7, 0.9);
        color: #333;
        border: 1px solid rgba(255, 193, 7, 0.5);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          margin: 0;
        }

        .header {
          padding: 1rem;
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .logout-btn {
          position: static;
          margin-top: 1rem;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .main-content {
          padding: 1rem;
        }

        .assign-word-form {
          flex-direction: column;
          align-items: stretch;
        }

        .assign-word input {
          min-width: auto;
        }

        table {
          font-size: 0.8rem;
        }

        th,
        td {
          padding: 0.5rem;
        }

        .config-content {
          padding: 20px 16px;
        }

        .wallet-display-group {
          flex-direction: column;
          align-items: stretch;
        }

        .wallet-display-input {
          min-width: unset;
        }

        .action-buttons {
          flex-direction: column;
        }

        .results-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Collapsible Section Styles */
      .collapsible-section {
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .collapsible-section.collapsed {
        height: auto;
      }

      .collapsible-section.collapsed .collapsible-content {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        overflow: hidden;
        opacity: 0;
      }

      .collapsible-content {
        max-height: 1000px;
        transition: all 0.3s ease;
        opacity: 1;
      }

      .collapsible-header {
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .collapsible-header:hover {
        filter: brightness(1.1);
      }

      .collapse-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
        transition: transform 0.3s ease;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .collapsible-section.collapsed .collapse-icon {
        transform: translateY(-50%);
      }

      /* Ensure collapsed sections show only header */
      .creator-fees-config.collapsed,
      .token-burn-config.collapsed,
      .social-links-config.collapsed,
      .admin-controls.collapsed {
        height: auto;
      }

      .creator-fees-config.collapsed .config-content,
      .token-burn-config.collapsed .burn-config-content,
      .social-links-config.collapsed .config-content,
      .admin-controls.collapsed .control-grid {
        max-height: 0;
        padding: 0 24px;
        overflow: hidden;
        opacity: 0;
      }

      /* Style adjustments for admin controls section */
      .admin-controls.collapsible-section .collapsible-header h3 {
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <!-- WebSocket status indicator -->
    <div id="websocketStatus" class="websocket-status connecting">
      üîÑ Connecting...
    </div>

    <!-- Login Section -->
    <div id="loginSection" class="login-form">
      <h2>üî• BURNdle Admin</h2>
      <div class="form-group">
        <label for="username">Username:</label>
        <input
          type="text"
          id="username"
          required
          placeholder="Enter username"
        />
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input
          type="password"
          id="password"
          required
          placeholder="Enter password"
        />
      </div>
      <button class="login-btn" onclick="login()">
        <span id="loginText">Login</span>
        <span id="loginLoading" class="loading hidden"></span>
      </button>
      <div id="loginError" class="error"></div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="container hidden">
      <div class="header">
        <h1>üî• BURNdle Admin Dashboard</h1>
        <p>
          Game statistics and player management -
          <span id="liveStatus">üî¥ Live Updates</span>
        </p>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>

      <div class="stats-section">
        <div id="statsSection" class="stats-grid">
          <!-- Basic stats will be loaded here -->
        </div>
      </div>


      <div class="main-content">
        <!-- Creator Fees Configuration with Current Fees Display -->
        <div class="creator-fees-config">
          <div class="config-header">
            <h3>Creator Fees Configuration</h3>
            <p class="config-subtitle">
              Configure which wallet address to track for creator earnings
            </p>
          </div>
          <div class="config-content">
            <!-- Current Configuration Display -->
            <div class="current-config">
              <div class="config-label">
                <span class="label-icon">üîó</span>
                Current Wallet Address
              </div>
              <div class="wallet-display-group">
                <input
                  type="text"
                  id="current-creator-wallet"
                  class="wallet-display-input"
                  readonly
                />
                <button onclick="copyCurrentWallet()" class="action-btn copy-btn">
                  <span class="btn-icon">üìã</span>
                  Copy
                </button>
                <a
                  id="current-profile-link"
                  href="#"
                  target="_blank"
                  class="action-btn view-btn"
                >
                  <span class="btn-icon">üëÅÔ∏è</span>
                  View Profile
                </a>
              </div>

              <!-- Current Fees Display -->
              <div
                id="current-fees-display"
                class="fees-stats-display"
              >
                <div class="results-grid">
                  <div class="result-item">
                    <div class="result-label">Total Fees (SOL)</div>
                    <div class="result-value fees-sol" id="current-fees-sol">
                      0.00 SOL
                    </div>
                  </div>
                  <div class="result-item">
                    <div class="result-label">Total Fees (USD)</div>
                    <div class="result-value fees-usd" id="current-fees-usd">
                      $0.00
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Update Configuration -->
            <div class="update-config">
              <div class="config-label">
                <span class="label-icon">‚úèÔ∏è</span>
                Update Wallet Address
              </div>
              <div class="update-group">
                <div class="input-with-validation">
                  <input
                    type="text"
                    id="new-creator-wallet"
                    class="wallet-input"
                    placeholder="Enter Solana wallet address (44 characters)"
                    maxlength="44"
                  />
                  <div class="input-validation" id="wallet-validation"></div>
                </div>
                <div class="action-buttons">
                  <button
                    onclick="testAndUpdateWallet()"
                    class="action-btn update-btn"
                    id="test-update-btn"
                    disabled
                  >
                    <span class="btn-icon">üíæ</span>
                    Update Address
                  </button>
                </div>
              </div>
            </div>

            <!-- Test Results -->
            <div id="test-results" class="test-results" style="display: none">
              <div class="results-header">
                <span class="label-icon">üìä</span>
                Test Results
              </div>
              <div class="results-grid">
                <div class="result-item">
                  <div class="result-label">SOL Fees</div>
                  <div class="result-value" id="test-sol-fees">-</div>
                </div>
                <div class="result-item">
                  <div class="result-label">USD Value</div>
                  <div class="result-value" id="test-usd-value">-</div>
                </div>
                <div class="result-item">
                  <div class="result-label">Coins Created</div>
                  <div class="result-value" id="test-coins-created">-</div>
                </div>
                <div class="result-item">
                  <div class="result-label">Data Source</div>
                  <div class="result-value" id="test-data-source">-</div>
                </div>
              </div>
            </div>

            <!-- Status Messages -->
            <div id="config-status" class="status-message"></div>
          </div>
        </div>

        <!-- Token Burn Configuration (complete implementation) -->
        <div class="token-burn-config">
          <div class="burn-config-header">
            <h3>Token Burn Tracker</h3>
            <p class="burn-config-subtitle">
              Configure token address to track burn percentage and supply data
            </p>
          </div>
          <div class="burn-config-content">
            <!-- Current Token Display -->
            <div class="current-token-section">
              <div class="config-label">
                <span class="label-icon">üî•</span>
                Current Token Being Tracked
              </div>
              <div class="token-display-group">
                <input
                  type="text"
                  id="current-token-address"
                  class="wallet-display-input"
                  readonly
                  placeholder="No token configured yet..."
                />
                <button
                  class="action-btn copy-btn"
                  onclick="copyTokenAddress()"
                  title="Copy token address"
                  id="copy-token-btn"
                  disabled
                >
                  <span class="btn-icon">üìã</span>
                  Copy
                </button>
                <a
                  id="current-token-link"
                  class="action-btn view-btn"
                  href="#"
                  target="_blank"
                  rel="noopener noreferrer"
                  title="View on Solscan"
                  style="display: none"
                >
                  <span class="btn-icon">üëÅÔ∏è</span>
                  View
                </a>
              </div>

              <!-- Current Token Stats -->
              <div
                id="current-burn-stats"
                class="burn-stats-display"
                style="display: none"
              >
                <div class="stats-grid">
                  <div class="stat-item">
                    <div class="stat-label">Burn Percentage</div>
                    <div class="stat-value burn-percentage" id="current-burn-percentage">
                      0.00%
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">Tokens Burned</div>
                    <div class="stat-value" id="current-tokens-burned">0</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">Current Supply</div>
                    <div class="stat-value" id="current-token-supply">0</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">Initial Supply</div>
                    <div class="stat-value" id="initial-token-supply">
                      1,000,000,000
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- New Token Configuration -->
            <div class="new-token-section">
              <div class="config-label">
                <span class="label-icon">üîß</span>
                Update Tracked Token
              </div>
              <div class="update-group">
                <div class="input-with-validation">
                  <input
                    type="text"
                    id="new-token-address"
                    class="wallet-input"
                    placeholder="Enter Solana token address (44 characters)"
                    maxlength="44"
                  />
                  <div class="validation-message" id="token-validation"></div>
                </div>

                <div class="action-buttons">
                  <button
                    class="action-btn update-btn"
                    onclick="testAndConfigureToken()"
                    id="test-configure-token-btn"
                    disabled
                  >
                    <span class="btn-icon">üíæ</span>
                    Update Token
                  </button>
                </div>

              </div>
            </div>

            <!-- Status Messages -->
            <div id="token-status" class="status-message"></div>
          </div>
        </div>

        <!-- Social Links Configuration -->
        <div class="social-links-config">
          <div class="config-header">
            <h3>Social Links Configuration</h3>
            <p class="config-subtitle">
              Update X (Twitter) and Pump.fun links in the header
            </p>
          </div>

          <div class="config-content">
            <!-- X (Twitter) Link -->
            <div class="link-config-section">
              <div class="config-label">
                <span class="label-icon">üê¶</span>
                X (Twitter) Link
              </div>
              <div class="link-input-group">
                <input
                  type="url"
                  id="x-link-input"
                  class="link-input"
                  placeholder="https://x.com/your_profile"
                />
                <button
                  onclick="updateXLink()"
                  class="action-btn update-btn"
                  id="update-x-btn"
                >
                  <span class="btn-icon">üîó</span>
                  Update X Link
                </button>
              </div>
            </div>

            <!-- Pump.fun Link -->
            <div class="link-config-section">
              <div class="config-label">
                <span class="label-icon">üöÄ</span>
                Pump.fun Link
              </div>
              <div class="link-input-group">
                <input
                  type="url"
                  id="pf-link-input"
                  class="link-input"
                  placeholder="https://pump.fun/coin/your_token_address"
                />
                <button
                  onclick="updatePfLink()"
                  class="action-btn update-btn"
                  id="update-pf-btn"
                >
                  <span class="btn-icon">üöÄ</span>
                  Update Pump.fun Link
                </button>
              </div>
            </div>

            <!-- Status Messages -->
            <div id="social-links-status" class="status-message"></div>
          </div>
        </div>

        <!-- Admin Control Section -->
        <div class="admin-controls">
          <h3>üéõÔ∏è Game Control Center</h3>
          <div class="control-grid">
            <div class="control-card">
              <h4>üìä Data Management</h4>
              <div class="control-buttons">
                <button class="control-btn refresh" onclick="refreshAllData()">
                  üîÑ Refresh Data
                </button>
                <button class="control-btn info" onclick="getSystemStatus()">
                  üìã System Status
                </button>
              </div>
            </div>

            <div class="control-card">
              <h4>‚è∏Ô∏è Game Control</h4>
              <div class="control-buttons">
                <button
                  class="control-btn warning"
                  id="pauseResumeBtn"
                  onclick="toggleGamePause()"
                >
                  ‚è∏Ô∏è Pause Game
                </button>
                <div class="pause-status" id="pauseStatus">
                  <span class="status-indicator active"></span>
                  <span>Game Active</span>
                </div>
              </div>
            </div>

            <div class="control-card">
              <h4>üèÅ Finish Game</h4>
              <div class="control-buttons">
                <button class="control-btn danger" id="finish-game-btn" onclick="toggleFinishGame()">
                  üèÅ Finish Game
                </button>
                <div class="pause-status" id="finishStatus">
                  <span class="status-indicator active"></span>
                  <span>Game Active</span>
                </div>
              </div>
            </div>

            <div class="control-card danger-zone">
              <h4>‚ö†Ô∏è Danger Zone</h4>
              <div class="control-buttons">
                <button class="control-btn danger" onclick="confirmResetAll()">
                  üóëÔ∏è Reset Everything
                </button>
                <p class="danger-warning">
                  This will reset ALL streaks, games, and data!
                </p>
              </div>
            </div>
          </div>
          <div id="controlMessage" class="control-message"></div>
        </div>


        <!-- Word Assignment Section -->
        <div class="assign-word">
          <h3>üéØ Assign Word to Player</h3>
          <div class="assign-word-form">
            <input
              type="text"
              id="walletInput"
              placeholder="Wallet Address (e.g., 4xQo...7KLm)"
              maxlength="44"
            />
            <input
              type="text"
              id="wordInput"
              placeholder="Word (5 letters)"
              maxlength="5"
            />
            <button class="assign-btn" onclick="assignWord()">
              Assign Word
            </button>
          </div>
          <div id="assignMessage"></div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
          <h3 style="margin-bottom: 1rem; color: #495057">üîç Search Players</h3>
          <div class="search-container">
            <input
              type="text"
              id="searchInput"
              class="search-input"
              placeholder="Search by wallet address (full or partial)..."
            />
            <button class="search-btn" onclick="searchPlayers()">Search</button>
            <button class="clear-search-btn" onclick="clearSearch()">
              Clear
            </button>
          </div>
          <div
            id="searchResultsInfo"
            class="search-results-info"
            style="display: none"
          ></div>
        </div>

        <!-- Players Section -->
        <div class="section" id="playersSection">
          <div class="section-title">
            <span>üë• All Players</span>
            <div>
              <button class="refresh-btn" onclick="loadPlayers()">
                üîÑ Refresh
              </button>
              <button class="refresh-btn" onclick="refreshAllData()">
                üîÑ Force Refresh
              </button>
            </div>
          </div>
          <div class="table-container">
            <table id="playersTable">
              <thead>
                <tr>
                  <th>Wallet Address</th>
                  <th onclick="sortTable('current_streak')" style="cursor: pointer;">Current Streak ‚áÖ</th>
                  <th onclick="sortTable('max_streak')" style="cursor: pointer;">Highest Streak ‚áÖ</th>
                  <th onclick="sortTable('avg_guesses')" style="cursor: pointer;">Avg Guesses/Win ‚áÖ</th>
                  <th onclick="sortTable('total_games_played')" style="cursor: pointer;">Games Played ‚áÖ</th>
                  <th onclick="sortTable('total_games_won')" style="cursor: pointer;">Games Won ‚áÖ</th>
                  <th onclick="sortTable('win_rate')" style="cursor: pointer;">Win Rate ‚áÖ</th>
                  <th>Next Word</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="playersTableBody">
                <!-- Players data will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      let authToken = localStorage.getItem("adminToken");
      let socket = null;
      let allPlayersData = [];
      let isGamePaused = false;
      let currentSort = { column: null, direction: 'asc' };

      // Initialize WebSocket connection
      function initializeWebSocket() {
        socket = io();

        socket.on("connect", () => {
          console.log("üîå Connected to WebSocket server");
          updateWebSocketStatus("connected", "üü¢ Live Updates");

          if (authToken) {
            socket.emit("admin-connect", { token: authToken });
          }
        });

        socket.on("disconnect", () => {
          console.log("üîå Disconnected from WebSocket server");
          updateWebSocketStatus("disconnected", "üî¥ Offline");
        });

        socket.on("connect_error", (error) => {
          console.error("üîå WebSocket connection error:", error);
          updateWebSocketStatus("disconnected", "üî¥ Error");
        });

        socket.on("admin-connected", (data) => {
          console.log("üëë Admin WebSocket connected:", data.message);
          updateWebSocketStatus("connected", "üü¢ Live Updates");
          checkGamePauseState();
        });

        socket.on("game-paused", (data) => {
          console.log("‚è∏Ô∏è Game paused:", data);
          isGamePaused = true;
          updatePauseUI(true);
          showControlMessage(
            `‚è∏Ô∏è Game paused by ${data.adminUsername}`,
            "warning"
          );
        });

        socket.on("game-resumed", (data) => {
          console.log("‚ñ∂Ô∏è Game resumed:", data);
          isGamePaused = false;
          updatePauseUI(false);
          showControlMessage(
            `‚ñ∂Ô∏è Game resumed by ${data.adminUsername}`,
            "success"
          );
        });

        socket.on("streak-updated", (data) => {
          console.log("üìä Real-time streak update:", data);
          showLiveUpdateNotification(
            `${data.walletAddress.slice(0, 8)}... ${
              data.isWin ? "WON" : "LOST"
            } - Streak: ${data.oldStreak}‚Üí${data.newStreak}`,
            data.isWin ? "success" : "danger"
          );
          setTimeout(() => loadPlayers(), 500);
        });

        // ‚úÖ NEW: Real-time admin dashboard updates
        socket.on("streak-reset", (data) => {
          console.log("üíî Real-time streak reset:", data);
          showLiveUpdateNotification(
            `${data.walletAddress.slice(0, 8)}... streak reset: ${data.oldCurrentStreak || data.oldStreak} ‚Üí 0`,
            "warning"
          );
          setTimeout(() => loadPlayers(), 500);
        });

        socket.on("leaderboard-updated", (data) => {
          console.log("üìä Real-time leaderboard update:", data);
          // Refresh admin dashboard when leaderboard changes
          setTimeout(() => loadPlayers(), 500);
        });

        socket.on("admin-should-refresh", (data) => {
          console.log("üîÑ Admin refresh requested:", data);
          showLiveUpdateNotification(
            `Dashboard refreshed: ${data.reason || 'System update'}`,
            "info"
          );
          setTimeout(() => {
            loadPlayers();
            loadStats();
          }, 1000);
        });
      }

      // Update WebSocket status indicator
      function updateWebSocketStatus(status, text) {
        const statusEl = document.getElementById("websocketStatus");
        const liveStatusEl = document.getElementById("liveStatus");

        if (statusEl) {
          statusEl.className = `websocket-status ${status}`;
          statusEl.textContent = text;
        }

        if (liveStatusEl) {
          liveStatusEl.textContent = text;
        }
      }

      // Show live update notification
      function showLiveUpdateNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = `live-update-notification ${type}`;
        notification.textContent = `üîî ${message}`;

        document.body.appendChild(notification);

        setTimeout(() => {
          if (notification.parentNode) {
            notification.style.animation = "slideInRight 0.3s ease-in reverse";
            setTimeout(() => notification.remove(), 300);
          }
        }, 5000);
      }

      // Initialize WebSocket on page load
      initializeWebSocket();

      // Check if already logged in
      if (authToken) {
        showDashboard();
      }

      // Allow Enter key to submit login
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("username")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") login();
          });
        document
          .getElementById("password")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") login();
          });

        // Initialize creator wallet configuration and token burn tracker
        loadCurrentWalletConfig();
        setupWalletValidation();
        loadCurrentTokenConfig();
        setupTokenValidation();
      });

      async function login() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;
        const errorDiv = document.getElementById("loginError");
        const loginText = document.getElementById("loginText");
        const loginLoading = document.getElementById("loginLoading");

        if (!username || !password) {
          errorDiv.textContent = "Please enter both username and password";
          return;
        }

        loginText.classList.add("hidden");
        loginLoading.classList.remove("hidden");
        errorDiv.textContent = "";

        try {
          const response = await fetch("/api/admin/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (data.success) {
            authToken = data.token;
            localStorage.setItem("adminToken", authToken);

            if (socket && socket.connected) {
              socket.emit("admin-connect", { token: authToken });
            }

            showDashboard();
          } else {
            errorDiv.textContent = data.error || "Login failed";
          }
        } catch (error) {
          console.error("Login error:", error);
          errorDiv.textContent = "Network error. Please check your connection.";
        } finally {
          loginText.classList.remove("hidden");
          loginLoading.classList.add("hidden");
        }
      }

      function logout() {
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("adminToken");
          authToken = null;

          if (socket) {
            socket.emit("admin-disconnect");
          }

          document.getElementById("loginSection").classList.remove("hidden");
          document.getElementById("dashboardSection").classList.add("hidden");
          document.getElementById("username").value = "";
          document.getElementById("password").value = "";
          document.getElementById("loginError").textContent = "";
        }
      }

      async function showDashboard() {
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("dashboardSection").classList.remove("hidden");

        await Promise.all([
          loadStats(),
          loadPlayers(),
          checkGamePauseState(), // ‚úÖ Make sure to check pause state on dashboard load
        ]);
      }

      async function loadStats() {
        try {
          const response = await fetch("/api/admin/stats", {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();

          if (data.success) {
            const statsHtml = `
              <div class="stat-card">
                <div class="stat-number">${data.data.totalPlayers}</div>
                <div class="stat-label">Total Players</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">${data.data.totalGamesPlayed}</div>
                <div class="stat-label">Games Played</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">${data.data.totalGamesWon}</div>
                <div class="stat-label">Games Won</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="admin-countdown">00:00</div>
                <div class="stat-label">Next Period</div>
              </div>
            `;
            document.getElementById("statsSection").innerHTML = statsHtml;

            // Start the countdown timer after stats are loaded
            initializeAdminCountdown();
          }
        } catch (error) {
          console.error("Error loading stats:", error);
        }
      }

      // ‚úÖ NEW: Admin Dashboard Countdown Timer
      let adminCountdownInterval = null;

      function initializeAdminCountdown() {
        // Clear any existing interval
        if (adminCountdownInterval) {
          clearInterval(adminCountdownInterval);
        }

        // Start the countdown timer
        updateAdminCountdown();
        adminCountdownInterval = setInterval(() => {
          updateAdminCountdown();
        }, 1000);

        console.log("üïê Admin countdown timer initialized");
      }

      function updateAdminCountdown() {
        const countdownElement = document.getElementById("admin-countdown");
        if (!countdownElement) return;

        const now = Date.now();
        const currentPeriod = Math.floor(now / 60000); // 1-minute periods
        const currentPeriodStart = currentPeriod * 60000;
        const nextPeriodStart = currentPeriodStart + 60000;
        const timeUntilReset = nextPeriodStart - now;

        const minutes = Math.floor(timeUntilReset / 60000);
        const seconds = Math.floor((timeUntilReset % 60000) / 1000);

        // Format time as MM:SS
        const formattedTime = `${minutes.toString().padStart(2, "0")}:${seconds
          .toString()
          .padStart(2, "0")}`;

        countdownElement.textContent = formattedTime;

        // Add visual indicator when time is running low
        if (timeUntilReset <= 10000) { // Last 10 seconds
          countdownElement.style.color = "#ff6b6b";
          countdownElement.style.fontWeight = "bold";
        } else if (timeUntilReset <= 30000) { // Last 30 seconds
          countdownElement.style.color = "#ffa726";
        } else {
          countdownElement.style.color = "";
          countdownElement.style.fontWeight = "";
        }
      }

      // NEW: Load current wallet configuration with fees display
      async function loadCurrentWalletConfig() {
        try {
          const response = await fetch("/api/admin/creator-fees");
          const result = await response.json();

          if (result.success && result.data.profileUrl) {
            const walletMatch =
              result.data.profileUrl.match(/profile\/([^?]+)/);
            if (walletMatch) {
              const currentWallet = walletMatch[1];
              document.getElementById("current-creator-wallet").value =
                currentWallet;
              document.getElementById("current-profile-link").href =
                result.data.profileUrl;

              // Display current fees
              document.getElementById(
                "current-fees-sol"
              ).textContent = `${result.data.totalFeesSOL.toFixed(4)} SOL`;
              document.getElementById("current-fees-usd").textContent = `${(
                result.data.totalFeesUSD || 0
              ).toFixed(2)}`;
              document.getElementById("current-coins-created").textContent =
                result.data.coinsCreated || 0;
              document.getElementById("current-fees-updated").textContent =
                new Date(result.data.lastUpdated).toLocaleString();

              document.getElementById("current-fees-display").style.display =
                "block";
            }
          }
        } catch (error) {
          console.error("Error loading current wallet config:", error);
        }
      }

      // Set up real-time wallet validation
      function setupWalletValidation() {
        const walletInput = document.getElementById("new-creator-wallet");
        const validation = document.getElementById("wallet-validation");
        const testUpdateBtn = document.getElementById("test-update-btn");

        walletInput.addEventListener("input", function () {
          const wallet = this.value.trim();
          validateWalletAddress(wallet, validation, testUpdateBtn);
        });
      }

      // Validate wallet address format
      function validateWalletAddress(wallet, validationEl, testUpdateBtn) {
        if (!wallet) {
          validationEl.className = "input-validation";
          testUpdateBtn.disabled = true;
          return;
        }

        const isValidLength = wallet.length >= 32 && wallet.length <= 44;
        const isValidChars = /^[A-Za-z0-9]+$/.test(wallet);

        if (isValidLength && isValidChars) {
          validationEl.textContent = "";
          validationEl.className = "input-validation";
          testUpdateBtn.disabled = false;
          document.getElementById("new-creator-wallet").className = "wallet-input";
        } else {
          validationEl.textContent = "";
          validationEl.className = "input-validation";
          testUpdateBtn.disabled = true;
          document.getElementById("new-creator-wallet").className = "wallet-input";
        }
      }

      // Copy current wallet to clipboard
      function copyCurrentWallet() {
        const walletInput = document.getElementById("current-creator-wallet");
        walletInput.select();
        document.execCommand("copy");
        showStatus("Wallet address copied to clipboard!", "success", 2000);
      }

      // NEW: Combined test and update wallet address function
      async function testAndUpdateWallet() {
        const newWallet = document
          .getElementById("new-creator-wallet")
          .value.trim();

        if (!newWallet) {
          showStatus("Please enter a wallet address", "error");
          return;
        }

        const testUpdateBtn = document.getElementById("test-update-btn");
        testUpdateBtn.disabled = true;
        testUpdateBtn.innerHTML =
          '<span class="btn-icon loading">‚è≥</span>Testing & Updating...';

        showStatus(
          "Testing wallet address and updating configuration...",
          "loading"
        );

        try {
          const response = await fetch("/api/admin/creator-fees", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ walletAddress: newWallet }),
          });

          const result = await response.json();

          if (result.success) {
            // Show test results
            document.getElementById(
              "test-sol-fees"
            ).textContent = `${result.data.totalFeesSOL.toFixed(4)} SOL`;
            document.getElementById("test-usd-value").textContent = `${(
              result.data.totalFeesUSD || 0
            ).toFixed(2)}`;
            document.getElementById("test-coins-created").textContent =
              result.data.coinsCreated || 0;
            document.getElementById("test-data-source").textContent =
              result.data.source || "Unknown";

            document.getElementById("test-results").style.display = "block";

            // Update current wallet display
            document.getElementById("current-creator-wallet").value = newWallet;
            document.getElementById(
              "current-profile-link"
            ).href = `https://pump.fun/profile/${newWallet}`;

            // Update current fees display
            document.getElementById(
              "current-fees-sol"
            ).textContent = `${result.data.totalFeesSOL.toFixed(4)} SOL`;
            document.getElementById("current-fees-usd").textContent = `$${(
              result.data.totalFeesUSD || 0
            ).toFixed(2)}`;

            // Clear form
            document.getElementById("new-creator-wallet").value = "";
            document.getElementById("wallet-validation").className =
              "input-validation";

            showStatus(
              "‚úÖ Wallet address tested and updated successfully!",
              "success"
            );
          } else {
            showStatus(`Test & update failed: ${result.error}`, "error");
          }
        } catch (error) {
          showStatus(`Test & update error: ${error.message}`, "error");
        } finally {
          testUpdateBtn.disabled = false;
          testUpdateBtn.innerHTML =
            '<span class="btn-icon">üß™</span>Test & Update Address';
        }
      }

      // Show status messages
      function showStatus(message, type, duration = 5000) {
        const statusEl = document.getElementById("config-status");
        statusEl.textContent = message;
        statusEl.className = `status-message status-${type} show`;

        if (type === "success" || type === "error") {
          setTimeout(() => {
            statusEl.className = "status-message";
          }, duration);
        }
      }

      // Placeholder functions for other admin functionality
      async function loadPlayers() {
        const tableBody = document.getElementById("playersTableBody");
        tableBody.innerHTML =
          '<tr><td colspan="9" style="text-align: center;">Loading players...</td></tr>';

        try {
          // ‚úÖ FIX: Add cache busting to ensure fresh data
          const timestamp = new Date().getTime();
          const response = await fetch(`/api/admin/players?_t=${timestamp}`, {
            headers: { Authorization: `Bearer ${authToken}` },
            cache: 'no-cache',
          });

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();

          if (data.success && data.data.length > 0) {
            allPlayersData = data.data;
            displayPlayers(allPlayersData);
          } else {
            allPlayersData = [];
            tableBody.innerHTML =
              '<tr><td colspan="9" class="empty-state">No players found</td></tr>';
          }
        } catch (error) {
          console.error("Error loading players:", error);
          tableBody.innerHTML =
            '<tr><td colspan="9" style="text-align: center; color: #dc3545;">Error loading players</td></tr>';
        }
      }

      function displayPlayers(playersToDisplay) {
        const tableBody = document.getElementById("playersTableBody");

        if (playersToDisplay.length === 0) {
          tableBody.innerHTML =
            '<tr><td colspan="9" class="empty-state">No players match your search</td></tr>';
          return;
        }

        const playersHtml = playersToDisplay
          .map((player) => {
            const winRate =
              player.total_games_played > 0
                ? (
                    (player.total_games_won / player.total_games_played) *
                    100
                  ).toFixed(1) + "%"
                : "0%";

            const avgGuesses = player.avg_guesses_per_win || "N/A";
            const nextWord = player.next_word || "Not assigned";
            const lastPlayed = player.last_played_date || "Never";

            const displayWallet =
              player.wallet_address.slice(0, 4) +
              "..." +
              player.wallet_address.slice(-4);

            return `
              <tr data-wallet="${player.wallet_address}">
                <td>
                  <span class="wallet-address" 
                        title="Click to copy: ${player.wallet_address}"
                        onclick="copyWalletAddress('${
                          player.wallet_address
                        }', this)">
                    ${displayWallet}
                    <span class="copy-icon">üìã</span>
                  </span>
                </td>
                <td><span class="streak">${player.current_streak}</span></td>
                <td><span class="streak">${player.max_streak}</span></td>
                <td>${avgGuesses}</td>
                <td>${player.total_games_played}</td>
                <td>${player.total_games_won}</td>
                <td><span class="win-rate">${winRate}</span></td>
                <td>
                  <span class="next-word">${nextWord}</span>
                </td>
                <td>
                  ${
                    (player.current_streak > 0 || player.max_streak > 0)
                      ? `<button class="assign-btn danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;"
                            onclick="resetPlayerStreak('${player.wallet_address}')">
                      Reset All Streaks
                    </button>`
                      : '<span style="color: #6c757d; font-size: 0.8rem;">No actions</span>'
                  }
                </td>
              </tr>
            `;
          })
          .join("");

        tableBody.innerHTML = playersHtml;
      }

      async function refreshAllData() {
        console.log("üîÑ Refreshing all dashboard data...");

        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = "üîÑ Refreshing...";
        btn.disabled = true;

        try {
          clearSearch();

          await Promise.all([
            loadStats(),
            loadPlayers(),
            checkGamePauseState(),
            loadCurrentWalletConfig(),
          ]);

          showControlMessage("‚úÖ All data refreshed successfully", "success");
        } catch (error) {
          console.error("Error refreshing data:", error);
          showControlMessage("‚ùå Failed to refresh some data", "error");
        } finally {
          btn.textContent = originalText;
          btn.disabled = false;
        }
      }

      async function getSystemStatus() {
        try {
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = "üìã Loading...";
          btn.disabled = true;

          const response = await fetch("/api/admin/system-status", {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();

          if (data.success) {
            const status = data.data;
            const statusMessage = `
              üìä System Status:
              ‚Ä¢ Total Players: ${status.totalPlayers}
              ‚Ä¢ Active Games: ${status.activeGames}
              ‚Ä¢ Game Status: ${status.isPaused ? "PAUSED" : "ACTIVE"}
              ‚Ä¢ Current Period: ${status.currentPeriod}
              ‚Ä¢ Server Memory: ${status.memoryUsage || "N/A"}
            `;

            showControlMessage(statusMessage, "info");
          } else {
            showControlMessage("‚ùå Failed to get system status", "error");
          }

          btn.textContent = originalText;
          btn.disabled = false;
        } catch (error) {
          console.error("Error getting system status:", error);
          showControlMessage("‚ùå Error getting system status", "error");
          event.target.textContent = "üìã System Status";
          event.target.disabled = false;
        }
      }

      async function checkGamePauseState() {
        try {
          const response = await fetch("/api/admin/game-pause-status", {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const data = await response.json();
            if (data.success) {
              isGamePaused = data.isPaused;
              updatePauseUI(isGamePaused);
              console.log(
                `üéõÔ∏è Game pause state: ${
                  isGamePaused ? "PAUSED" : "ACTIVE"
                } (by ${data.pausedBy || "N/A"})`
              );
            }
          }
        } catch (error) {
          console.warn("Could not check game pause state:", error);
        }
      }

      async function toggleGamePause() {
        const btn = document.getElementById("pauseResumeBtn");
        const action = isGamePaused ? "resume" : "pause";

        if (
          !confirm(
            `Are you sure you want to ${action} the game for ALL players?`
          )
        ) {
          return;
        }

        const originalText = btn.textContent;
        btn.textContent =
          action === "pause" ? "‚è∏Ô∏è Pausing..." : "‚ñ∂Ô∏è Resuming...";
        btn.disabled = true;

        try {
          console.log(`üéõÔ∏è Attempting to ${action} game...`);

          const response = await fetch(`/api/admin/game-${action}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              adminUsername: "admin",
              reason: `Manual ${action} from dashboard`,
            }),
          });

          console.log(`üéõÔ∏è Response status: ${response.status}`);

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();
          console.log(`üéõÔ∏è Response data:`, data);

          if (data.success) {
            // Update local state immediately
            isGamePaused = action === "pause";
            updatePauseUI(isGamePaused);

            const message =
              action === "pause"
                ? "‚è∏Ô∏è Game paused for all players"
                : "‚ñ∂Ô∏è Game resumed for all players";
            showControlMessage(
              message,
              action === "pause" ? "warning" : "success"
            );

            console.log(`‚úÖ Game ${action} successful`);
          } else {
            showControlMessage(
              `‚ùå Failed to ${action} game: ${data.error}`,
              "error"
            );
            console.error(`‚ùå Failed to ${action} game:`, data.error);
          }
        } catch (error) {
          console.error(`‚ùå Error ${action}ing game:`, error);
          showControlMessage(
            `‚ùå Error ${action}ing game: ${error.message}`,
            "error"
          );
        } finally {
          btn.disabled = false;
          updatePauseButtonText();
        }
      }

      function updatePauseUI(paused) {
        console.log(`üéõÔ∏è Updating pause UI - paused: ${paused}`);

        const btn = document.getElementById("pauseResumeBtn");
        const status = document.getElementById("pauseStatus");
        const indicator = status.querySelector(".status-indicator");
        const statusText = status.querySelector("span:last-child");

        if (paused) {
          indicator.className = "status-indicator paused";
          statusText.textContent = "Game Paused";
          btn.textContent = "‚ñ∂Ô∏è Resume Game";
          btn.className = "control-btn refresh";
          console.log(`üéõÔ∏è UI updated to PAUSED state`);
        } else {
          indicator.className = "status-indicator active";
          statusText.textContent = "Game Active";
          btn.textContent = "‚è∏Ô∏è Pause Game";
          btn.className = "control-btn warning";
          console.log(`üéõÔ∏è UI updated to ACTIVE state`);
        }
      }

      function updatePauseButtonText() {
        const btn = document.getElementById("pauseResumeBtn");
        console.log(`üéõÔ∏è Updating button text - isGamePaused: ${isGamePaused}`);

        if (isGamePaused) {
          btn.textContent = "‚ñ∂Ô∏è Resume Game";
          btn.className = "control-btn refresh";
        } else {
          btn.textContent = "‚è∏Ô∏è Pause Game";
          btn.className = "control-btn warning";
        }
      }

      function confirmResetAll() {
        const confirmation = prompt(
          "‚ö†Ô∏è DANGER: This will DELETE ALL data!\n\n" +
            "Type 'RESET EVERYTHING' to confirm:"
        );

        if (confirmation === "RESET EVERYTHING") {
          resetAllData();
        } else if (confirmation !== null) {
          showControlMessage(
            "‚ùå Reset cancelled - incorrect confirmation",
            "warning"
          );
        }
      }

      async function resetAllData() {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = "üóëÔ∏è Resetting...";
        btn.disabled = true;

        try {
          const response = await fetch("/api/admin/reset-all-data", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              adminUsername: "admin",
              confirmationCode: "RESET_EVERYTHING_NOW",
            }),
          });

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();

          if (data.success) {
            showControlMessage(
              `üóëÔ∏è All data reset successfully! ${data.message}`,
              "error"
            );

            allPlayersData = [];
            clearSearch();
            setTimeout(() => {
              loadStats();
              loadPlayers();
            }, 1000);
          } else {
            showControlMessage(`‚ùå Reset failed: ${data.error}`, "error");
          }
        } catch (error) {
          console.error("Error resetting data:", error);
          showControlMessage("‚ùå Error resetting data", "error");
        } finally {
          btn.textContent = originalText;
          btn.disabled = false;
        }
      }

      function showControlMessage(message, type) {
        const messageEl = document.getElementById("controlMessage");
        messageEl.textContent = message;
        messageEl.className = `control-message ${type}`;
        messageEl.style.display = "block";

        setTimeout(() => {
          messageEl.style.display = "none";
        }, 5000);
      }

      async function assignWord() {
        const walletAddress = document
          .getElementById("walletInput")
          .value.trim();
        const word = document
          .getElementById("wordInput")
          .value.trim()
          .toLowerCase();
        const messageDiv = document.getElementById("assignMessage");

        if (!walletAddress || !word) {
          messageDiv.innerHTML =
            '<div class="error">Please enter both wallet address and word</div>';
          return;
        }

        if (word.length !== 5 || !/^[a-z]+$/.test(word)) {
          messageDiv.innerHTML =
            '<div class="error">Word must be exactly 5 letters and contain only alphabetic characters</div>';
          return;
        }

        try {
          const response = await fetch("/api/admin/assign-word", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({ walletAddress, word }),
          });

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();

          if (data.success) {
            messageDiv.innerHTML =
              '<div class="success">‚úÖ ' + data.message + "</div>";
            document.getElementById("walletInput").value = "";
            document.getElementById("wordInput").value = "";

            setTimeout(() => {
              loadPlayers();
              messageDiv.innerHTML = "";
            }, 2000);
          } else {
            messageDiv.innerHTML =
              '<div class="error">‚ùå ' + data.error + "</div>";
          }
        } catch (error) {
          console.error("Error assigning word:", error);
          messageDiv.innerHTML =
            '<div class="error">‚ùå Network error occurred</div>';
        }
      }

      function searchPlayers() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.trim()
          .toLowerCase();
        const resultsInfo = document.getElementById("searchResultsInfo");

        if (!searchTerm) {
          showTempMessage("Please enter a search term", "error");
          return;
        }

        console.log("üîç Searching for:", searchTerm);

        const filteredPlayers = allPlayersData.filter((player) => {
          const walletAddress = player.wallet_address.toLowerCase();
          return walletAddress.includes(searchTerm);
        });

        console.log(
          `üìä Search results: ${filteredPlayers.length} players found`
        );

        displayPlayers(filteredPlayers);

        resultsInfo.style.display = "block";
        if (filteredPlayers.length > 0) {
          resultsInfo.innerHTML = `Found ${filteredPlayers.length} player(s) matching "${searchTerm}"`;
          resultsInfo.style.color = "#28a745";
        } else {
          resultsInfo.innerHTML = `No players found matching "${searchTerm}"`;
          resultsInfo.style.color = "#dc3545";
        }

        showTempMessage(
          `Found ${filteredPlayers.length} player(s)`,
          filteredPlayers.length > 0 ? "success" : "warning"
        );
      }

      function clearSearch() {
        document.getElementById("searchInput").value = "";
        document.getElementById("searchResultsInfo").style.display = "none";

        displayPlayers(allPlayersData);

        showTempMessage("Search cleared - showing all players", "success");
      }

      function sortTable(column) {
        console.log('üîÄ Sorting by:', column);

        // Toggle direction if same column, otherwise default to ascending
        if (currentSort.column === column) {
          currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.column = column;
          currentSort.direction = 'asc';
        }

        // Get current displayed data (could be filtered)
        const currentDisplayed = getCurrentDisplayedPlayers();

        const sortedData = [...currentDisplayed].sort((a, b) => {
          let aVal, bVal;

          switch (column) {
            case 'current_streak':
              aVal = Number(a.current_streak) || 0;
              bVal = Number(b.current_streak) || 0;
              break;
            case 'max_streak':
              aVal = Number(a.max_streak) || 0;
              bVal = Number(b.max_streak) || 0;
              break;
            case 'avg_guesses':
              // Calculate avg guesses for sorting
              aVal = a.total_games_won > 0 ? a.total_guesses / a.total_games_won : 0;
              bVal = b.total_games_won > 0 ? b.total_guesses / b.total_games_won : 0;
              break;
            case 'total_games_played':
              aVal = Number(a.total_games_played) || 0;
              bVal = Number(b.total_games_played) || 0;
              break;
            case 'total_games_won':
              aVal = Number(a.total_games_won) || 0;
              bVal = Number(b.total_games_won) || 0;
              break;
            case 'win_rate':
              aVal = a.total_games_played > 0 ? (a.total_games_won / a.total_games_played) * 100 : 0;
              bVal = b.total_games_played > 0 ? (b.total_games_won / b.total_games_played) * 100 : 0;
              break;
            default:
              return 0;
          }

          if (currentSort.direction === 'asc') {
            return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
          } else {
            return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
          }
        });

        displayPlayers(sortedData);
        updateSortIndicators();
      }

      function getCurrentDisplayedPlayers() {
        // Check if there's an active search
        const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
        if (searchTerm) {
          return allPlayersData.filter((player) => {
            const walletAddress = player.wallet_address.toLowerCase();
            return walletAddress.includes(searchTerm);
          });
        }
        return allPlayersData;
      }

      function updateSortIndicators() {
        // Remove existing sort indicators
        document.querySelectorAll('th').forEach(th => {
          const text = th.textContent.replace(/\s*[‚Üë‚Üì‚áÖ]/, '');
          th.innerHTML = th.innerHTML.replace(/\s*[‚Üë‚Üì‚áÖ]/, '');
        });

        // Add indicator to current sort column
        if (currentSort.column) {
          const headerMap = {
            'current_streak': 1,
            'max_streak': 2,
            'avg_guesses': 3,
            'total_games_played': 4,
            'total_games_won': 5,
            'win_rate': 6
          };

          const headerIndex = headerMap[currentSort.column];
          if (headerIndex !== undefined) {
            const header = document.querySelectorAll('th')[headerIndex];
            if (header) {
              const arrow = currentSort.direction === 'asc' ? ' ‚Üë' : ' ‚Üì';
              header.innerHTML = header.innerHTML.replace(' ‚áÖ', '') + arrow;
            }
          }
        }
      }

      async function resetPlayerStreak(walletAddress) {
        const shortWallet = walletAddress.slice(0, 8) + "...";

        console.log(`üîç ADMIN RESET FRONTEND - Starting reset for ${shortWallet}`);

        if (
          !confirm(
            `Are you sure you want to reset BOTH current and max streaks for ${shortWallet}?`
          )
        ) {
          console.log(`üîç ADMIN RESET FRONTEND - User cancelled reset for ${shortWallet}`);
          return;
        }

        try {
          console.log(`üîç ADMIN RESET FRONTEND - Sending reset request for ${shortWallet}`);

          const response = await fetch("/api/admin/admin-reset-player-streak", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              walletAddress,
              reason: "Manual admin reset",
              adminUsername: "admin",
            }),
          });

          if (response.status === 401) {
            logout();
            return;
          }

          console.log(`üîç ADMIN RESET FRONTEND - Response status: ${response.status}`);

          const data = await response.json();

          console.log(`üîç ADMIN RESET FRONTEND - Response data:`, data);

          if (data.success) {
            console.log(`üîç ADMIN RESET FRONTEND - Reset successful for ${shortWallet}`);
            console.log(`üîç ADMIN RESET FRONTEND - Old streaks: Current=${data.oldCurrentStreak || data.oldStreak || 'unknown'}, Max=${data.oldMaxStreak || 'unknown'}`);
            console.log(`üîç ADMIN RESET FRONTEND - New streaks: Current=${data.newCurrentStreak || 'unknown'}, Max=${data.newMaxStreak || 'unknown'}`);

            const message = `‚úÖ Reset streaks for ${shortWallet}: Current ${data.oldCurrentStreak || data.oldStreak || 0}‚Üí0, Max ${data.oldMaxStreak || 0}‚Üí0`;
            showTempMessage(message, "success");

            setTimeout(() => {
              console.log(`üîç ADMIN RESET FRONTEND - Refreshing player data for ${shortWallet}`);
              highlightPlayerRow(walletAddress);
              loadPlayers();
            }, 500);
          } else {
            console.log(`üîç ADMIN RESET FRONTEND - Reset failed for ${shortWallet}:`, data.error);
            showTempMessage("‚ùå " + data.error, "error");
          }
        } catch (error) {
          console.error("Error resetting player streak:", error);
          showTempMessage("‚ùå Failed to reset player streak", "error");
        }
      }

      function highlightPlayerRow(walletAddress) {
        const row = document.querySelector(
          `tr[data-wallet="${walletAddress}"]`
        );
        if (row) {
          row.classList.add("table-row-updated");
          setTimeout(() => {
            row.classList.remove("table-row-updated");
          }, 3000);
        }
      }

      async function copyWalletAddress(fullAddress, element) {
        try {
          await navigator.clipboard.writeText(fullAddress);

          const originalContent = element.innerHTML;
          element.classList.add("copied");
          element.innerHTML = `${fullAddress.slice(0, 8)}...${fullAddress.slice(
            -8
          )} ‚úÖ`;

          showTempMessage("Wallet address copied to clipboard!", "success");

          setTimeout(() => {
            element.classList.remove("copied");
            element.innerHTML = originalContent;
          }, 2000);
        } catch (err) {
          console.error("Failed to copy wallet address:", err);

          const textArea = document.createElement("textarea");
          textArea.value = fullAddress;
          document.body.appendChild(textArea);
          textArea.select();

          try {
            document.execCommand("copy");
            showTempMessage("Wallet address copied to clipboard!", "success");

            element.classList.add("copied");
            setTimeout(() => element.classList.remove("copied"), 2000);
          } catch (fallbackErr) {
            showTempMessage("Could not copy to clipboard", "error");
          }

          document.body.removeChild(textArea);
        }
      }

      // Show temporary message
      function showTempMessage(message, type = "success") {
        const existingMessage = document.getElementById("tempMessage");
        if (existingMessage) {
          existingMessage.remove();
        }

        const messageEl = document.createElement("div");
        messageEl.id = "tempMessage";
        messageEl.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${
            type === "success"
              ? "#28a745"
              : type === "error"
              ? "#dc3545"
              : type === "warning"
              ? "#ffc107"
              : "#17a2b8"
          };
          color: ${type === "warning" ? "#333" : "white"};
          padding: 12px 20px;
          border-radius: 6px;
          font-weight: 500;
          z-index: 9999;
          animation: slideInRight 0.3s ease-out;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;
        messageEl.textContent = message;

        if (!document.querySelector("#copyMessageStyles")) {
          const style = document.createElement("style");
          style.id = "copyMessageStyles";
          style.textContent = `
            @keyframes slideInRight {
              from {
                transform: translateX(100%);
                opacity: 0;
              }
              to {
                transform: translateX(0);
                opacity: 1;
              }
            }
            @keyframes slideOutRight {
              from {
                transform: translateX(0);
                opacity: 1;
              }
              to {
                transform: translateX(100%);
                opacity: 0;
              }
            }
          `;
          document.head.appendChild(style);
        }

        document.body.appendChild(messageEl);

        setTimeout(() => {
          messageEl.style.animation = "slideOutRight 0.3s ease-in forwards";
          setTimeout(() => messageEl.remove(), 300);
        }, 3000);
      }

      // Format word input to lowercase
      document.addEventListener("DOMContentLoaded", function () {
        const wordInput = document.getElementById("wordInput");
        if (wordInput) {
          wordInput.addEventListener("input", function (e) {
            e.target.value = e.target.value
              .toLowerCase()
              .replace(/[^a-z]/g, "");
          });
        }

        // Allow Enter key for search
        const searchInput = document.getElementById("searchInput");
        if (searchInput) {
          searchInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              searchPlayers();
            }
          });
        }
      });

      // TOKEN BURN TRACKER FUNCTIONS

      // Load current token configuration
      async function loadCurrentTokenConfig() {
        try {
          const storedToken = localStorage.getItem("configuredTokenAddress");
          if (storedToken) {
            document.getElementById("current-token-address").value =
              storedToken;
            document.getElementById("copy-token-btn").disabled = false;
            document.getElementById(
              "current-token-link"
            ).href = `https://solscan.io/token/${storedToken}`;
            document.getElementById("current-token-link").style.display =
              "flex";

            // Load current burn stats
            await loadCurrentBurnStats(storedToken);
          }
        } catch (error) {
          console.error("Error loading token config:", error);
        }
      }

      // Load current burn statistics
      async function loadCurrentBurnStats(tokenAddress) {
        try {
          const response = await fetch(
            `/api/admin/token-burn?tokenAddress=${tokenAddress}`
          );
          const result = await response.json();

          if (result.success) {
            const data = result.data;
            document.getElementById(
              "current-burn-percentage"
            ).textContent = `${data.burnPercentage.toFixed(2)}%`;
            document.getElementById("current-tokens-burned").textContent =
              data.burnedAmount.toLocaleString();
            document.getElementById("current-token-supply").textContent =
              data.currentSupply.toLocaleString();
            document.getElementById("initial-token-supply").textContent =
              data.initialSupply.toLocaleString();
            document.getElementById("current-burn-stats").style.display =
              "block";
          }
        } catch (error) {
          console.error("Error loading burn stats:", error);
        }
      }

      // Set up token validation
      function setupTokenValidation() {
        const tokenInput = document.getElementById("new-token-address");
        const validation = document.getElementById("token-validation");
        const testConfigureBtn = document.getElementById(
          "test-configure-token-btn"
        );

        tokenInput.addEventListener("input", function () {
          const token = this.value.trim();
          validateTokenAddress(token, validation, testConfigureBtn);
        });
      }

      // Validate token address
      function validateTokenAddress(token, validationEl, testConfigureBtn) {
        if (!token) {
          validationEl.className = "input-validation";
          testConfigureBtn.disabled = true;
          return;
        }

        const isValidLength = token.length >= 32 && token.length <= 44;
        const isValidChars = /^[A-Za-z0-9]+$/.test(token);

        if (isValidLength && isValidChars) {
          validationEl.textContent = "";
          validationEl.className = "input-validation";
          testConfigureBtn.disabled = false;
          document.getElementById("new-token-address").className = "wallet-input";
        } else {
          validationEl.textContent = "";
          validationEl.className = "input-validation";
          testConfigureBtn.disabled = true;
          document.getElementById("new-token-address").className = "wallet-input";
        }
      }

      // Copy token address
      function copyTokenAddress() {
        const tokenInput = document.getElementById("current-token-address");
        tokenInput.select();
        document.execCommand("copy");
        showTokenStatus("Token address copied to clipboard!", "success", 2000);
      }

      // Test and configure token tracking (combined function)
      async function testAndConfigureToken() {
        const tokenAddress = document
          .getElementById("new-token-address")
          .value.trim();

        if (!tokenAddress) {
          showTokenStatus("Please enter a token address", "error");
          return;
        }

        const testConfigureBtn = document.getElementById(
          "test-configure-token-btn"
        );
        testConfigureBtn.disabled = true;
        testConfigureBtn.innerHTML =
          '<span class="btn-icon loading">‚è≥</span>Testing & Configuring...';

        showTokenStatus(
          "Analyzing token and configuring tracking...",
          "loading"
        );

        try {
          // First test the token
          const testResponse = await fetch(
            `/api/admin/token-burn?tokenAddress=${tokenAddress}`
          );
          const testResult = await testResponse.json();

          if (testResult.success) {
            const data = testResult.data;


            // Now configure the tracking
            const configResponse = await fetch("/api/admin/token-burn/config", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                tokenAddress,
                initialSupply: null,
              }),
            });

            const configResult = await configResponse.json();

            if (configResult.success) {
              // Save to localStorage
              localStorage.setItem("configuredTokenAddress", tokenAddress);

              // Update current token display
              document.getElementById("current-token-address").value =
                tokenAddress;
              document.getElementById("copy-token-btn").disabled = false;
              document.getElementById(
                "current-token-link"
              ).href = `https://solscan.io/token/${tokenAddress}`;
              document.getElementById("current-token-link").style.display =
                "flex";

              // Fetch fresh data after configuration
              const freshResponse = await fetch(
                `/api/admin/token-burn?tokenAddress=${tokenAddress}`
              );
              const freshResult = await freshResponse.json();

              if (freshResult.success) {
                const freshData = freshResult.data;

                // Update current stats display with fresh data
                document.getElementById(
                  "current-burn-percentage"
                ).textContent = `${freshData.burnPercentage.toFixed(2)}%`;
                document.getElementById("current-tokens-burned").textContent =
                  freshData.burnedAmount.toLocaleString();
                document.getElementById("current-token-supply").textContent =
                  freshData.currentSupply.toLocaleString();
                document.getElementById("initial-token-supply").textContent =
                  freshData.initialSupply.toLocaleString();
              } else {
                // Use original data if fresh fetch fails
                document.getElementById(
                  "current-burn-percentage"
                ).textContent = `${data.burnPercentage.toFixed(2)}%`;
                document.getElementById("current-tokens-burned").textContent =
                  data.burnedAmount.toLocaleString();
                document.getElementById("current-token-supply").textContent =
                  data.currentSupply.toLocaleString();
                document.getElementById("initial-token-supply").textContent =
                  data.initialSupply.toLocaleString();
              }

              document.getElementById("current-burn-stats").style.display =
                "block";

              // Clear form
              document.getElementById("new-token-address").value = "";
              document.getElementById("token-validation").className =
                "input-validation";

              showTokenStatus(
                "‚úÖ Token tested and tracking configured successfully!",
                "success"
              );
            } else {
              showTokenStatus(
                `Configuration failed: ${configResult.error}`,
                "error"
              );
            }
          } else {
            showTokenStatus(
              `Token analysis failed: ${testResult.error}`,
              "error"
            );
          }
        } catch (error) {
          showTokenStatus(`Error: ${error.message}`, "error");
        } finally {
          testConfigureBtn.disabled = false;
          testConfigureBtn.innerHTML =
            '<span class="btn-icon">üß™</span>Test & Configure Token';
        }
      }

      // Show token status messages
      function showTokenStatus(message, type, duration = 5000) {
        const statusEl = document.getElementById("token-status");
        statusEl.textContent = message;
        statusEl.className = `status-message status-${type} show`;

        if (type === "success" || type === "error") {
          setTimeout(() => {
            statusEl.className = "status-message";
          }, duration);
        }
      }

      /**
       * Update X (Twitter) Link
       */
      async function updateXLink() {
        const input = document.getElementById("x-link-input");
        const btn = document.getElementById("update-x-btn");
        const newLink = input.value.trim();

        if (!newLink) {
          showSocialLinksStatus("Please enter a valid X link", "error");
          return;
        }

        // Basic URL validation
        if (!isValidURL(newLink)) {
          showSocialLinksStatus("Please enter a valid URL", "error");
          return;
        }

        // Disable button and show loading
        btn.disabled = true;
        btn.innerHTML = '<span class="btn-icon loading">‚è≥</span>Updating...';
        showSocialLinksStatus("Updating X link...", "loading");

        try {
          const response = await fetch("/api/admin/update-social-links", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              type: "x",
              url: newLink,
            }),
          });

          const result = await response.json();

          if (result.success) {
            showSocialLinksStatus("‚úÖ X link updated successfully!", "success");
            input.value = ""; // Clear input

            // Optional: Update the actual link on the frontend if the page is open
            updateFrontendXLink(newLink);
          } else {
            showSocialLinksStatus(
              `Failed to update X link: ${result.error}`,
              "error"
            );
          }
        } catch (error) {
          showSocialLinksStatus(
            `Error updating X link: ${error.message}`,
            "error"
          );
        } finally {
          btn.disabled = false;
          btn.innerHTML = '<span class="btn-icon">üîó</span>Update X Link';
        }
      }

      /**
       * Update Pump.fun Link
       */
      async function updatePfLink() {
        const input = document.getElementById("pf-link-input");
        const btn = document.getElementById("update-pf-btn");
        const newLink = input.value.trim();

        if (!newLink) {
          showSocialLinksStatus("Please enter a valid Pump.fun link", "error");
          return;
        }

        // Basic URL validation
        if (!isValidURL(newLink)) {
          showSocialLinksStatus("Please enter a valid URL", "error");
          return;
        }

        // Disable button and show loading
        btn.disabled = true;
        btn.innerHTML = '<span class="btn-icon loading">‚è≥</span>Updating...';
        showSocialLinksStatus("Updating Pump.fun link...", "loading");

        try {
          const response = await fetch("/api/admin/update-social-links", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              type: "pf",
              url: newLink,
            }),
          });

          const result = await response.json();

          if (result.success) {
            showSocialLinksStatus(
              "‚úÖ Pump.fun link updated successfully!",
              "success"
            );
            input.value = ""; // Clear input

            // Optional: Update the actual link on the frontend if the page is open
            updateFrontendPfLink(newLink);
          } else {
            showSocialLinksStatus(
              `Failed to update Pump.fun link: ${result.error}`,
              "error"
            );
          }
        } catch (error) {
          showSocialLinksStatus(
            `Error updating Pump.fun link: ${error.message}`,
            "error"
          );
        } finally {
          btn.disabled = false;
          btn.innerHTML =
            '<span class="btn-icon">üöÄ</span>Update Pump.fun Link';
        }
      }

      /**
       * Show status messages for social links
       */
      function showSocialLinksStatus(message, type, duration = 5000) {
        const statusEl = document.getElementById("social-links-status");
        statusEl.textContent = message;
        statusEl.className = `status-message status-${type} show`;

        if (type === "success" || type === "error") {
          setTimeout(() => {
            statusEl.className = "status-message";
          }, duration);
        }
      }

      /**
       * Basic URL validation
       */
      function isValidURL(string) {
        try {
          new URL(string);
          return true;
        } catch (error) {
          return false;
        }
      }

      /**
       * Update frontend X link (if main page is open in another tab)
       */
      function updateFrontendXLink(newUrl) {
        // This would require WebSocket or postMessage to update live
        // For now, just log the update
        console.log("üê¶ X link updated to:", newUrl);
      }

      /**
       * Update frontend Pump.fun link (if main page is open in another tab)
       */
      function updateFrontendPfLink(newUrl) {
        // This would require WebSocket or postMessage to update live
        // For now, just log the update
        console.log("üöÄ Pump.fun link updated to:", newUrl);
      }

      // Stop game functionality
      async function stopGame() {
        console.log("üõë stopGame function called");
        console.log("üõë authToken:", authToken ? "present" : "missing");

        if (!confirm("üèÅ Are you sure you want to finish the game? This will end the current game and show the final results.")) {
          console.log("üõë User cancelled confirmation");
          return;
        }

        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = "üèÅ Stopping...";
        btn.disabled = true;

        try {
          console.log("üõë Attempting to stop game...");
          console.log("üõë Making fetch request to /api/admin/game-stop");

          const response = await fetch("/api/admin/game-stop", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              adminUsername: "admin",
              reason: "Manual stop from dashboard",
            }),
          });

          console.log(`üõë Response status: ${response.status}`);

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();
          console.log(`üõë Response data:`, data);

          if (data.success) {
            isGameFinished = true;
            const btn = document.getElementById('finish-game-btn');
            btn.textContent = "üö´ Cancel";
            btn.className = "control-btn warning";
            updateFinishStatus("finished");
          } else {
            showControlMessage(`‚ùå Failed to stop game: ${data.error}`, "error");
          }
        } catch (error) {
          console.error("Error stopping game:", error);
          showControlMessage("‚ùå Error stopping game", "error");
        } finally {
          // Only reset text if game finish failed (success case handles text change)
          if (!isGameFinished) {
            btn.textContent = originalText;
          }
          btn.disabled = false;
        }
      }

      // ============================== FINISH GAME TOGGLE FUNCTIONALITY ==============================

      let isGameFinished = false;

      async function toggleFinishGame() {
        if (isGameFinished) {
          // Cancel the finished game
          await cancelFinishGame();
        } else {
          // Start/finish the game
          await stopGame();
        }
      }

      async function cancelFinishGame() {
        console.log("üö´ cancelFinishGame function called");

        const btn = document.getElementById('finish-game-btn');
        const originalText = btn.textContent;
        btn.textContent = "üö´ Cancelling...";
        btn.disabled = true;

        try {
          const response = await fetch("/api/admin/game-cancel", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              adminUsername: "admin",
              reason: "Manual cancel from dashboard",
            }),
          });

          if (response.status === 401) {
            logout();
            return;
          }

          const data = await response.json();
          console.log(`üö´ Cancel response data:`, data);

          if (data.success) {
            isGameFinished = false;
            btn.textContent = "üèÅ Finish Game";
            btn.className = "control-btn danger";
            updateFinishStatus("active");
          } else {
            showControlMessage(`‚ùå Failed to cancel: ${data.error}`, "error");
          }
        } catch (error) {
          console.error("Error cancelling game:", error);
          showControlMessage("‚ùå Error cancelling game", "error");
        } finally {
          btn.disabled = false;
        }
      }

      // ============================== FINISH GAME STATUS UPDATE ==============================

      function updateFinishStatus(status) {
        const statusElement = document.getElementById('finishStatus');
        const indicator = statusElement?.querySelector('.status-indicator');
        const text = statusElement?.querySelector('span:last-child');

        if (!statusElement || !indicator || !text) return;

        // Clear existing classes
        indicator.className = 'status-indicator';

        if (status === 'finished') {
          indicator.classList.add('paused');
          text.textContent = 'Game Finished';
        } else if (status === 'active') {
          indicator.classList.add('active');
          text.textContent = 'Game Active';
        }
      }

      // Collapsible Section Functionality
      function initializeCollapsibleSections() {
        const sections = [
          'creator-fees-config',
          'token-burn-config',
          'social-links-config',
          'admin-controls'
        ];

        sections.forEach(sectionId => {
          const section = document.querySelector(`.${sectionId}`);
          if (section) {
            // Add collapsible classes
            section.classList.add('collapsible-section', 'collapsed');

            // Find the header element
            let header;
            if (sectionId === 'creator-fees-config' || sectionId === 'social-links-config') {
              header = section.querySelector('.config-header');
            } else if (sectionId === 'token-burn-config') {
              header = section.querySelector('.burn-config-header');
            } else if (sectionId === 'admin-controls') {
              // For admin-controls, we need to create a header wrapper
              const h3 = section.querySelector('h3');
              if (h3) {
                const headerDiv = document.createElement('div');
                headerDiv.className = 'collapsible-header';
                headerDiv.style.background = 'rgba(255, 255, 255, 0.1)';
                headerDiv.style.padding = '24px';
                headerDiv.style.textAlign = 'center';
                headerDiv.style.borderBottom = '1px solid rgba(255, 255, 255, 0.15)';

                // Move h3 into header
                section.insertBefore(headerDiv, section.firstChild);
                headerDiv.appendChild(h3);
                header = headerDiv;
              }
            }

            if (header) {
              header.classList.add('collapsible-header');

              // Add collapse icon
              const icon = document.createElement('span');
              icon.className = 'collapse-icon';
              icon.textContent = '+';
              header.appendChild(icon);

              // Add click event
              header.addEventListener('click', () => toggleSection(section));
            }
          }
        });
      }

      function toggleSection(section) {
        const isCollapsed = section.classList.contains('collapsed');
        const icon = section.querySelector('.collapse-icon');

        if (isCollapsed) {
          // Expand
          section.classList.remove('collapsed');
          if (icon) icon.textContent = '‚àí';
        } else {
          // Collapse
          section.classList.add('collapsed');
          if (icon) icon.textContent = '+';
        }
      }

      // Initialize collapsible sections when DOM is loaded
      document.addEventListener('DOMContentLoaded', () => {
        initializeCollapsibleSections();
      });

    </script>
  </body>
</html>
